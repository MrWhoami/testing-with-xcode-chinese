# 测试基础
测试是指检验你的应用程序和库代码的代码，会根据预期结果决定成功或是失败。测试可能会在执行一些操作后检查一个对象的实例变量的状态，或是确保你的代码在受到边界条件变化时会抛出一个特定异常等等。对于一项性能测试，参考标准一般是你所期望的操作处理完成所需的最长时间。

## 定义测试范围
所有的软件都是组合体，也就是说，小组件组合到一起形成较大的、功能更强的高级组件，直到符合项目的需求。良好的测试需要涵盖该组合的所有层次的功能。XCTest 允许你为各个级别的组件编写相应的测试。

测试组件由什么构成取决于你自己，它可以是一个类中的一个方法，也可以是完成一个基本目的的一组方法。例如，可以是一个算数运算，就像 [快速开始](https://github.com/MrWhoami/testing-with-xcode-chinese/wiki/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B-Quick-Start) 一章中的计算器应用的例子。处理 `TableView` 的内容和代码数据结构中维护的名称列表间的交互有各种各样的方法。每个方法和操作都意味着应用程序功能的一个组成部分和对其的测试。一个测试组件的行为应该是完全确定的，无论测试成功或者失败。

把你的应用程序的行为划分为越多的组件，就越能有效地测试你的代码是否能满足参考标准的各种细节，尤其是当项目不断增长和变化时。对于有很多组件的大型项目来说，你需要运行很多测试来彻底检测整个项目。如果可能的话，测试应该快速运行，但有一些测试确实很大，所以运行的可能会慢些。当有一些故障问题时，可以经常运行一些小型的快速的测试，这样可以轻松诊断和修复问题。

为项目组件设计测试是测试驱动开发[^1]的基础，所谓测试驱动开发是指一种在编写代码测试之前先编写测试逻辑的编码风格。这种开发方法可以让你在实现之前确定代码需求和边界情况。编写测试后，你要开发旨在通过测试的算法。在代码通过测试后，你才有了优化代码的基础，才有信心在下一次运行这些测试时能发现所有预期行为的变化（这导致你的产品出现 bug）。

甚至在你不使用测试驱动开发时，测试也可以降低你在修改代码以增强代码的特性和功能时引入的 bug 数量。在一款运行的应用程序中进行测试以确保未来的更改不会以你计划以外的方式改变应用的行为。当你修复这些 bug 后，你需要添加测试以确认这些 bug 已经被修复。测试应该同时检测你的代码中所预期的成功和所预期的失败，以覆盖所有边界条件。

> **注意：**为一个没有考虑到测试的项目添加测试可能会要求重构部分代码来使测试更加简单。[附录A：编写可测试的代码](https://github.com/MrWhoami/testing-with-xcode-chinese/blob/master/A-编写可测试代码-WritingTestableCode.md) 中有可能对你有用的编写可测试代码的简单指南。

组件可以包括你的应用程序的各部分之间的交互。由于有些类型的测试可能需要很长时间，所以你可能希望只是定期或者只在一台服务器上运行它们。下面一节你将看到，你可以组织自己的测试并以多种方式运行它们，以满足不同的需求。

## 性能测试
组建的测试既可以测试功能也可以测试性能。XCText 为时间相关的性能测试提供了 API，使你能够通过一种和功能变化相似的方式跟踪性能变化。

性能测试必须要有一个基准线作为参照才能提供一个成功或失败的测试结果。基准线是执行测试10次的平均时间性能和每次执行测试的标准差的结合。未达到时间基准线或每次运行偏差过大的测试都会被认为是失败的。

> **注意：**当你第一次运行性能测试的时候，XCTest 总是会提示失败因为测试基准线还未确定。当你接受某一次测试作为基准线后，XCTest 才会评估并反馈成功或失败并向你提供一种能看到测试结果细节的途径。

## 用户交互界面测试
上面讨论的性能和功能测试一般被称为单元测试，其中“单元”指你根据粒度和层级所决定的功能组件。单元测试主要关心的是形成良好的组件，这些组件将会按照预期运行并按照预期与其它组件交互。从设计角度看，单元测试会从内部来处理你的开发项目，审查这些组件是否完全达到了你的要求。

用户通过用户交互界面来与你代码的内部进行交互。用户交互界面的交互行为一般是粗粒度的更高层次行为，会进行外部活动并整合一些组件（子系统）的操作以调用你应用的功能。如果没有被特殊设计的从应用环境外部操作用户交互界面的工具，想要编写单元测试来测试用户通过用户交互界面体验的交互操作是很难的。用这些特殊工具写成的测试被称为“用户交互界面测试”

用户交互界面测试从外部界面处理你测试中的应用，就像用户所体验的那样。你可以通过这种测试向系统提供的或自定义的用户交互界面对象发送仿真事件，从这些对象那里获取响应，然后测试响应的正确性和性能，很大程度上就像你对内向型的单元测试做的那样。

## 应用测试和库测试
Xcode提供两种类型的单元测试环境[^2]：应用程序测试和库测试。

* **应用测试**。应用测试可以检查应用行为的正确性，比如计算器应用的算术运算的例子。
* **库测试**。库测试可以在非应用运行时独立地检查的动态库或框架行为的正确性。利用库测试，你可以编写对库中组件进行的单元测试。

当你的项目在不断的推进的时候，恰当地使用这些测试环境测试你的项目可以帮助你维持你的代码行为总是和预期一致。

## XCTest—Xcode 测试框架
XCTest 是 Xcode 5及以上版本中使用的测试框架。

关于版本和兼容性：

* Xcode 5，XCTest 运行在 OS X v10.8 和 OS X v10.9 上，兼容 iOS 7 与之后版本。
* Xcode 6，XCTest 运行在 OS X v10.9 和 OS X v10.10 上，兼容 iOS 6 与之后版本。
* Xcode 7，XCTest 运行在 OS X v10.10 和 OS X v10.11 上，兼容 iOS 6 与之后版本。用户交互界面测试支持在 OS X 10.11 和 iOS 9 上运行，无论是在模拟器中还是在设备上。

更多版本兼容细节信息，参见 [Xcode Release Notes](https://developer.apple.com/library/ios/releasenotes/DeveloperTools/RN-Xcode/Chapters/Introduction.html#//apple_ref/doc/uid/TP40001051)。

Xcode 把 `XCTest.framework` 并入你的项目。该框架提供可以让你设计测试并在代码上运行你的测试的 API。关于 XCTest 框架的详细信息，参见 *XCTest Framework Reference*。

>注意：Xcode包括一个迁移助手，可用来转换包含 OCUnit 测试的项目。更多 OCUnit 向 XCTest 转换的详细信息，请参阅 [附录B：从 OCUnit 到 XCTest](https://github.com/MrWhoami/testing-with-xcode-chinese/blob/master/B-从 OCUnit到XCTest-TranstioningFromOCUnitToXCTest.md)。

##测试从哪里入手
当你开始创建测试时，记住下面的方法：

* 专注于测试你的代码与 Controller 交互的最基础的 Model 类和方法。  
应用程序的高级框图很可能会包含 Model、View 和 Controller 类，对于每个使用 Cocoa 和 Cocoa Touch 的开发者来说，这是一个熟悉的设计模式。当你编写要覆盖所有 Model 类的测试时，你必须要知道应用的基础已经很高地通过了的测试，而且要在编写Controller 类测试之前--它将带你接触你应用程序更复杂的部分，例如链接一个在网络服务后面的数据库所在的网络。  
作为一个可选的起始点，如果你正在编写一个框架或库，你可能想从 API 的接口开始。从那里，你可以按照你的方式进入内部类。
* 当创建一个用户交互界面测试时，总是从最常见的工作流程开始考虑。思考用户最开始使用应用的时候会做什么，哪个用户交互界面在此过程中会被调用。使用用户交互界面记录这个特性是一个记录用户行为序列并导入用户交互界面测试方法的很好的办法，这个测试方法可以扩充以测试正确性和／或性能。  
这一类的用户交互界面测试通常从一个相对粗粒度的着眼点开始，并且可能会涉及到几个子系统，这些子系统会返回很多的信息以至于一开始难以分析。当你开始使用你的用户交互界面测试套件的时候，你可以重定义测试的粒度从而使用户交互界面测试更清晰地反应特定的子系统的行为。

[^1]: 测试驱动开发：Test-driven development，TDD
[^2]: 测试环境：Test context